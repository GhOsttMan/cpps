const path = require('path');

const rootPath = path.resolve(__dirname, '../../../');

module.exports = {
  rootPath,
  myRender,
  grabMiddleware
};

function myRender(req, res, view, context = {}) {
  const sess = req.session || {};
  if (sess.login) {
    context.login = true;
    context.email = sess.email;
    context.status = sess.status;
  }

  const flashContext = req.flash('context');
  const len = flashContext.length;
  for (let i = 0; i < len; i++) {
    for (const val in flashContext[i]) {
      context[val] = flashContext[i][val];
    }
  }

  return res.render(view, context);
}

function grabMiddleware(name) {
  return require(path.join(rootPath, 'middlewares', name));
}
