/* Middle ware to maintain User Hierarchy
 *
 * 0. root
 * 1. admin
 */

module.exports = {
  isRoot(req, res, next) {
    const sess = req.session || {};
    const regexApi = /^\/api\/v1/g;
    if (regexApi.exec(req.originalUrl)) {
      if (sess.status === 'root') return next();
      return res.status(401).json({
        status: 401,
        message: 'Unauthorized: You are not Root',
        route: req.originalUrl,
      });
    }

    if (sess.status === 'root') return next();
    else {
      req.flash('info', 'You must be root to proceed');
      return res.status(401).redirect('/');
    }
  },
  isAdmin(req, res, next) {
    const sess = req.session || {};
    if (sess.status === 'root' || sess.status === 'admin') return next();
    else {
      req.flash('info', 'You must be at least "admin" to proceed');
      return res.status(401).redirect('/');
    }
  },
};
