/**
 *Middle ware to test whether user is logged in or not
 */

module.exports = function(req, res, next) {
  const sess = req.session || {};
  if (sess.login) return next();
  else {
    const regexApi = /^\/api\/v1/g;
    if (regexApi.match(req.originalUrl)) {
      return res.status(401).json({
        status: 401,
        message: 'Unauthorized: You need to login',
      });
    } else {
      req.flash('info', 'Please login and try again');
      return res.status(401).redirect('/user/login');
    }
  }
};
